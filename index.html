<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>B√∫squeda del Tesoro AR</title>

  <!-- A-Frame & AR.js -->
  <script src="https://cdn.jsdelivr.net/gh/aframevr/aframe@1.6.0/dist/aframe-master.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>

  <style>
    html, body {
      height: 100%;
      margin: 0;
      overflow: hidden;
      background: #000;
      font-family: Arial, sans-serif;
    }

    /* Pantalla de carga */
    .arjs-loader {
      height: 100%;
      width: 100%;
      position: absolute;
      top: 0;
      left: 0;
      background-color: rgba(0, 0, 0, 0.8);
      z-index: 9999;
      display: flex;
      justify-content: center;
      align-items: center;
      color: white;
      font-size: 1.2rem;
      text-align: center;
    }

    /* Panel de informaci√≥n */
    .hud {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 10000;
      background: rgba(0, 0, 0, 0.6);
      color: white;
      padding: 12px 14px;
      border-radius: 10px;
      max-width: 320px;
    }

    .hud h3 {
      margin: 0 0 6px 0;
      font-size: 1rem;
    }

    .hud p {
      margin: 0;
      font-size: 0.9rem;
    }

    .btn-reset {
      background: #007bff;
      padding: 6px 10px;
      color: white;
      border-radius: 6px;
      margin-top: 8px;
      cursor: pointer;
      display: inline-block;
      font-size: 0.9rem;
    }

    .treasure-overlay {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255, 255, 255, 0.95);
      color: #111;
      padding: 20px;
      border-radius: 12px;
      text-align: center;
      display: none;
      z-index: 10001;
      width: 80%;
      max-width: 360px;
    }

    .treasure-overlay button {
      background: #007bff;
      border: none;
      color: white;
      padding: 8px 14px;
      border-radius: 8px;
      margin-top: 10px;
      cursor: pointer;
    }

    a-scene {
      position: relative !important;
      z-index: 1;
    }
  </style>
</head>

<body>

  <!-- Pantalla de carga -->
  <div class="arjs-loader" id="loader">
    Cargando juego AR... <br> Permite el uso de la c√°mara.
  </div>

  <!-- Panel de informaci√≥n -->
  <div class="hud" id="hud">
    <h3>üîé B√∫squeda del Tesoro AR</h3>
    <p>Escanea los 3 marcadores para descubrir las pistas y encontrar el tesoro.</p>
    <p><b>Progreso:</b> <span id="foundCount">0</span> / 3</p>
    <div id="clueList">
      <p>‚Ä¢ Marcador A: ‚ùå</p>
      <p>‚Ä¢ Marcador B: ‚ùå</p>
      <p>‚Ä¢ Marcador C: ‚ùå</p>
    </div>
    <div class="btn-reset" id="resetBtn">Reiniciar b√∫squeda</div>
  </div>

  <!-- Tesoro final -->
  <div class="treasure-overlay" id="treasureOverlay">
    <h2>üéâ ¬°Tesoro encontrado! üéâ</h2>
    <p>Has encontrado todas las pistas. ¬°Excelente trabajo!</p>
    <button id="closeTreasure">Cerrar</button>
  </div>

  <!-- Escena de A-Frame -->
  <a-scene
    vr-mode-ui="enabled: false"
    embedded
    renderer="logarithmicDepthBuffer: true; precision: medium;"
    arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;"
  >

    <!-- MARCADOR 1 (HIRO) -->
    <a-marker preset="hiro" id="marker-hiro">
      <a-box position="0 0.5 0" color="tomato"
        animation="property: rotation; to: 0 360 0; loop: true; dur: 4000">
      </a-box>
      <a-text value="Pista 1: Busca la escalera este" position="0 1.2 0" align="center" width="3"></a-text>
    </a-marker>

    <!-- MARCADOR 2 (KANJI) -->
    <a-marker preset="kanji" id="marker-kanji">
      <a-sphere position="0 0.5 0" color="gold"
        animation="property: scale; to: 1.3 1.3 1.3; dir: alternate; loop: true; dur: 1000">
      </a-sphere>
      <a-text value="Pista 2: Frente a la sala de lectura" position="0 1.2 0" align="center" width="3"></a-text>
    </a-marker>

    <!-- MARCADOR 3 (BARCODE 5) -->
    <a-marker type="barcode" value="5" id="marker-barcode">
      <a-cylinder position="0 0.5 0" color="seagreen"
        animation="property: position; to: 0 0.8 0; dir: alternate; loop: true; dur: 800">
      </a-cylinder>
      <a-text value="Pista 3: Revisa el mural central" position="0 1.2 0" align="center" width="3"></a-text>
    </a-marker>

    <a-entity camera></a-entity>

    <!-- Sonidos -->
    <a-entity id="audioHost">
      <a-sound id="foundSound" src="https://cdn.jsdelivr.net/gh/ai-tux/sounds@master/ding.mp3" autoplay="false" positional="false"></a-sound>
      <a-sound id="treasureSound" src="https://cdn.jsdelivr.net/gh/ai-tux/sounds@master/fanfare.mp3" autoplay="false" positional="false"></a-sound>
    </a-entity>

  </a-scene>

  <script>
    // --- Variables principales ---
    const loader = document.getElementById("loader");
    const hudCount = document.getElementById("foundCount");
    const clueList = document.getElementById("clueList");
    const overlay = document.getElementById("treasureOverlay");
    const resetBtn = document.getElementById("resetBtn");
    const closeBtn = document.getElementById("closeTreasure");

    const markers = {
      "marker-hiro": { name: "Marcador A", found: false },
      "marker-kanji": { name: "Marcador B", found: false },
      "marker-barcode": { name: "Marcador C", found: false },
    };

    // --- Ocultar loader cuando la escena carga ---
    window.addEventListener("load", () => {
      loader.style.display = "none";
    });

    // --- Funci√≥n para actualizar progreso en pantalla ---
    function updateHUD() {
      const found = Object.values(markers).filter(m => m.found).length;
      hudCount.textContent = found;
      let html = "";
      for (const key in markers) {
        html += `<p>‚Ä¢ ${markers[key].name}: ${markers[key].found ? "‚úÖ" : "‚ùå"}</p>`;
      }
      clueList.innerHTML = html;
      if (found === 3) {
        document.getElementById("treasureSound").components.sound.playSound();
        overlay.style.display = "block";
      }
    }

    // --- Escucha de marcadores ---
    function setupMarkers() {
      for (const id in markers) {
        const el = document.getElementById(id);
        el.addEventListener("markerFound", () => {
          if (!markers[id].found) {
            markers[id].found = true;
            document.getElementById("foundSound").components.sound.playSound();
            updateHUD();
          }
        });
      }
    }

    setupMarkers();

    // --- Botones ---
    resetBtn.onclick = () => {
      for (const id in markers) markers[id].found = false;
      overlay.style.display = "none";
      updateHUD();
    };
    closeBtn.onclick = () => overlay.style.display = "none";
  </script>
</body>
</html>


