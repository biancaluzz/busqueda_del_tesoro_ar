<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>🧭 Busqueda del Tesoro AR</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
            background: #000;
        }
        .arjs-loader {
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            background: #000;
        }
        .instructions {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 1000;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 15px;
            border-radius: 10px;
            max-width: 300px;
        }
        .progress {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1000;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 15px;
            border-radius: 10px;
        }
        .pista {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.95);
            color: gold;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            z-index: 10000;
            border: 2px solid gold;
            max-width: 350px;
            display: none;
        }
        .completion {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.95);
            color: gold;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            z-index: 10000;
            border: 3px solid gold;
        }
        button {
            background: gold;
            color: black;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <div class="instructions">
        <h2>🧭 Busqueda del Tesoro</h2>
        <p>Completa el semaforo:</p>
        <ol>
            <li>🔴 </li>
            <li>🟡 </li>
            <li>🟢 </li>
        </ol>
        <p><strong>Pista inicial: Dirigite al salon que resulta de la suma de los 3 primeros numeros pares.</strong></p>
    </div>

    <div class="progress">
        <h3>Progreso</h3>
        <div id="progress-text">0/3 encontrados</div>
    </div>

    <div class="pista" id="pista">
        <h3 id="pista-titulo">Nueva Pista!</h3>
        <p id="pista-texto"></p>
        <button onclick="cerrarPista()">Continuar</button>
    </div>

    <div class="completion" id="completion">
        <h1>🎉 Felicitaciones! 🎉</h1>
        <p>🚦 Completaste la busqueda del tesoro 🚦</p>
        <button onclick="resetGame()">Jugar de Nuevo</button>
    </div>

    <a-scene 
        vr-mode-ui="enabled: false"
        arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
        embedded
        renderer="logarithmicDepthBuffer: true;">

        <!-- Marcador 1 - Cubo Rojo -->
        <a-marker 
            id="marker1" 
            preset="hiro"
            emitevents="true"
            smooth="true"
            smoothCount="10"
            smoothTolerance="0.01">
            
            <a-box position="0 0.5 0" color="red" scale="0.5 0.5 0.5"
                   animation="property: rotation; to: 0 360 0; loop: true; dur: 3000">
            </a-box>
            <a-text value="Por que el rojo se canso?\nPorque siempre tenia que PARAR!" position="0 1.2 0" rotation="0 0 90" align="center" color="red" scale="0.5 0.5 0.5" look-at="[camera]"></a-text>
        </a-marker>

        <!-- Marcador 2 - Cono Amarillo -->
        <a-marker 
            id="marker2" 
            preset="kanji"
            emitevents="true"
            smooth="true"
            smoothCount="10"
            smoothTolerance="0.01">
            
            <a-cone position="0 0.5 0" color="yellow" height="1" radius-bottom="0.4"
                    animation="property: rotation; to: 0 360 0; loop: true; dur: 2000">
            </a-cone>
            <a-text value="Que dijo el amarillo al verde?\nNo me APURES, voy lento!" position="0 1.5 0" rotation="0 0 90" align="center" color="yellow" scale="0.5 0.5 0.5" look-at="[camera]"></a-text>
        </a-marker>

        <!-- Marcador 3 - Esfera Verde -->
        <a-marker 
            id="marker3" 
            type="barcode" 
            value="5"
            emitevents="true"
            smooth="true"
            smoothCount="10"
            smoothTolerance="0.01">
            
            <a-sphere position="0 0.5 0" color="green" radius="0.4"
                   animation="property: rotation; to: 45 45 45; loop: true; dur: 1500">
            </a-sphere>
            <a-text value="Por que el verde es feliz?\nPorque siempre puede AVANZAR!" position="0 1.3 0" rotation="0 0 90" align="center" color="green" scale="0.5 0.5 0.5" look-at="[camera]"></a-text>
        </a-marker>

        <a-entity camera></a-entity>
    </a-scene>

    <script>
        let foundMarkers = new Set();
        const totalMarkers = 3;
        
        // Sistema de pistas
        const pistas = {
            marker1: "Status Code: ... - OK.",
            marker2: "Si volteas la fecha de la noche de brujas, vas a completar el semaforo.",
            marker3: ""
        };

        // Detectar marcadores encontrados
        document.addEventListener('DOMContentLoaded', function() {
            const markers = document.querySelectorAll('a-marker');
            
            markers.forEach(marker => {
                marker.addEventListener('markerFound', function() {
                    const markerId = this.id;
                    
                    if (!foundMarkers.has(markerId)) {
                        foundMarkers.add(markerId);
                        updateProgress();
                        
                        // Mostrar pista
                        mostrarPista(markerId);
                        
                        // Efecto visual
                        this.setAttribute('animation', {
                            property: 'scale',
                            from: '1 1 1',
                            to: '1.2 1.2 1.2',
                            dur: 500,
                            easing: 'easeOutElastic'
                        });
                        
                        setTimeout(() => {
                            this.removeAttribute('animation');
                        }, 500);
                        
                        // Verificar si ganó
                        if (foundMarkers.size === totalMarkers) {
                            setTimeout(showCompletion, 1000);
                        }
                    }
                });
            });
        });

        function mostrarPista(markerId) {
            const pista = document.getElementById('pista');
            const titulo = document.getElementById('pista-titulo');
            const texto = document.getElementById('pista-texto');
            
            titulo.textContent = markerId === 'marker3' ? '🎉 Felicitaciones!' : '🔍 Nueva Pista!';
            texto.textContent = pistas[markerId];
            pista.style.display = 'block';
        }

        function cerrarPista() {
            document.getElementById('pista').style.display = 'none';
        }

        function updateProgress() {
            const progressText = document.getElementById('progress-text');
            progressText.textContent = `${foundMarkers.size}/${totalMarkers} encontrados`;
            
            // Cambiar color según progreso
            if (foundMarkers.size === totalMarkers) {
                progressText.style.color = 'gold';
            } else if (foundMarkers.size > 0) {
                progressText.style.color = '#4CAF50';
            }
        }

        function showCompletion() {
            const completion = document.getElementById('completion');
            completion.style.display = 'block';
            
            // Efectos de confeti simple
            createConfetti();
        }

        function createConfetti() {
            const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff'];
            const completion = document.getElementById('completion');
            
            for (let i = 0; i < 20; i++) {
                const confetti = document.createElement('div');
                confetti.style.position = 'fixed';
                confetti.style.width = '10px';
                confetti.style.height = '10px';
                confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.borderRadius = '50%';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.top = '-10px';
                confetti.style.zIndex = '9999';
                confetti.style.animation = `fall ${Math.random() * 2 + 1}s linear forwards`;
                
                document.body.appendChild(confetti);
                
                // Crear animación CSS
                if (!document.querySelector('#confetti-style')) {
                    const style = document.createElement('style');
                    style.id = 'confetti-style';
                    style.textContent = `
                        @keyframes fall {
                            to {
                                transform: translateY(100vh) rotate(${Math.random() * 360}deg);
                                opacity: 0;
                            }
                        }
                    `;
                    document.head.appendChild(style);
                }
                
                setTimeout(() => confetti.remove(), 3000);
            }
        }

        function resetGame() {
            foundMarkers.clear();
            updateProgress();
            document.getElementById('completion').style.display = 'none';
            document.getElementById('pista').style.display = 'none';
        }
    </script>
</body>
</html>
