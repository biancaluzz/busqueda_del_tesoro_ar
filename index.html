<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>üß≠ B√∫squeda del Tesoro AR</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: Arial, sans-serif; }
        
        .instructions, .progress, .pista {
            position: absolute; z-index: 1000; 
            background: rgba(0,0,0,0.9); color: white; 
            padding: 20px; border-radius: 15px; max-width: 350px;
        }
        
        .instructions { top: 10px; left: 10px; }
        .progress { top: 10px; right: 10px; text-align: center; }
        .pista { 
            top: 50%; left: 50%; transform: translate(-50%, -50%);
            text-align: center; border: 2px solid gold;
            display: none;
        }
        
        .completion {
            display: none; position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%); background: rgba(0,0,0,0.95);
            color: gold; padding: 40px; border-radius: 20px; text-align: center;
            border: 3px solid gold; z-index: 10000; max-width: 400px;
        }
        
        button {
            background: gold; color: black; border: none; 
            padding: 12px 25px; border-radius: 8px; font-size: 16px; 
            cursor: pointer; margin-top: 20px; font-weight: bold;
        }
        
        h3 { color: #4CC3D9; margin-top: 0; }
        .pista h3 { color: gold; }
    </style>
</head>
<body>
    <!-- Instrucciones iniciales -->
    <div class="instructions">
        <h3>üß≠ B√∫squeda del Tesoro - Sacr√© Coeur</h3>
        <p><strong>Pista inicial:</strong> El primer marcador est√° cerca de la ENTRADA PRINCIPAL del edificio</p>
        <ol>
            <li>üìú Marcador Inicial</li>
            <li>üóùÔ∏è Marcador de la Llave</li>
            <li>üíé Marcador del Tesoro</li>
        </ol>
    </div>

    <!-- Progreso -->
    <div class="progress">
        <h3>Progreso</h3>
        <div id="progress-text">0/3 encontrados</div>
    </div>

    <!-- Panel de pistas -->
    <div class="pista" id="pista">
        <h3 id="pista-titulo">¬°Nueva Pista!</h3>
        <p id="pista-texto"></p>
        <button onclick="cerrarPista()">Continuar</button>
    </div>

    <!-- Mensaje final -->
    <div class="completion" id="completion">
        <h2>üéâ ¬°FELICITACIONES! üéâ</h2>
        <p>¬°Has completado la b√∫squeda del tesoro del Sacr√© Coeur!</p>
        <p>Eres un verdadero explorador AR</p>
        <button onclick="resetGame()">Jugar de Nuevo</button>
    </div>

    <a-scene 
        vr-mode-ui="enabled: false"
        arjs="sourceType: webcam; debugUIEnabled: false;"
        embedded
        renderer="logarithmicDepthBuffer: true;">

        <!-- üìú MARCADOR 1 - ENTRADA PRINCIPAL -->
        <a-marker id="marker1" preset="hiro">
            <!-- Objeto 3D: Pir√°mide dorada -->
            <a-cone 
                position="0 0.5 0" 
                color="#FFD700" 
                height="1" 
                radius-bottom="0.5"
                animation="property: rotation; to: 0 360 0; loop: true; dur: 4000">
            </a-cone>
            
            <!-- Texto flotante -->
            <a-text 
                value="¬°Primer Marcador!" 
                position="0 1.5 0" 
                align="center" 
                color="#4CC3D9"
                scale="1.5 1.5 1.5">
            </a-text>
            
            <!-- Efecto de luz -->
            <a-light type="point" intensity="1.5" color="#4CC3D9" position="1 2 1"></a-light>
        </a-marker>

        <!-- üóùÔ∏è MARCADOR 2 - BIBLIOTECA -->
        <a-marker id="marker2" preset="kanji">
            <!-- Objeto 3D: Llave dorada -->
            <a-cylinder 
                position="0 0.3 0" 
                color="#FFD700" 
                radius="0.1" 
                height="0.8"
                animation="property: rotation; to: 360 0 0; loop: true; dur: 2000">
            </a-cylinder>
            
            <!-- Anillo de la llave -->
            <a-torus 
                position="0 0.8 0" 
                color="#FFD700" 
                arc="360" 
                radius="0.2" 
                radius-tubular="0.05">
            </a-torus>
            
            <!-- Texto flotante -->
            <a-text 
                value="¬°Llave M√°gica!" 
                position="0 1.5 0" 
                align="center" 
                color="#FFD700"
                scale="1.5 1.5 1.5">
            </a-text>
        </a-marker>

        <!-- üíé MARCADOR 3 - AZOTEA -->
        <a-marker id="marker3" type="barcode" value="5">
            <!-- Objeto 3D: Cofre del tesoro -->
            <a-box 
                position="0 0.3 0" 
                color="#964B00" 
                scale="0.8 0.4 0.5"
                animation="property: rotation; to: 0 360 0; loop: true; dur: 3000">
            </a-box>
            
            <!-- Tapa del cofre -->
            <a-box 
                position="0 0.6 0" 
                color="#B8860B" 
                scale="0.7 0.1 0.45"
                animation="property: rotation; to: 45 0 0; loop: true; dir: alternate; dur: 2000">
            </a-box>
            
            <!-- Tesoro interior -->
            <a-sphere 
                position="0 0.45 0" 
                color="#FFD700" 
                radius="0.15"
                animation="property: position; to: 0 0.6 0; loop: true; dir: alternate; dur: 1000">
            </a-sphere>
            
            <!-- Texto flotante -->
            <a-text 
                value="¬°TESORO!" 
                position="0 1.5 0" 
                align="center" 
                color="#FF6B6B"
                scale="2 2 2">
            </a-text>
            
            <!-- Efectos de luz -->
            <a-light type="point" intensity="3" color="gold" position="1 2 1"></a-light>
        </a-marker>

        <a-entity camera></a-entity>
    </a-scene>

    <script>
        let foundMarkers = new Set();
        const pistas = {
            marker1: "¬°Bien! El siguiente marcador est√° en la BIBLIOTECA del edificio. Busca un libro especial...",
            marker2: "¬°Excelente! El tesoro final est√° en la AZOTEA. Sube y encuentra la recompensa...",
            marker3: "¬°FELICITACIONES! Has encontrado el tesoro del Sacr√© Coeur."
        };

        // Detectar marcadores
        document.querySelectorAll('a-marker').forEach(marker => {
            marker.addEventListener('markerFound', function() {
                if (!foundMarkers.has(this.id)) {
                    foundMarkers.add(this.id);
                    updateProgress();
                    
                    // Mostrar pista correspondiente
                    mostrarPista(this.id);
                    
                    // Si es el √∫ltimo marcador, mostrar felicitaci√≥n
                    if (foundMarkers.size === 3) {
                        setTimeout(() => {
                            document.getElementById('completion').style.display = 'block';
                            crearConfetti();
                        }, 2000);
                    }
                }
            });
        });

        function updateProgress() {
            document.getElementById('progress-text').textContent = 
                `${foundMarkers.size}/3 encontrados`;
            
            // Cambiar color del progreso
            const progress = document.getElementById('progress-text');
            if (foundMarkers.size === 3) {
                progress.style.color = 'gold';
                progress.style.fontWeight = 'bold';
            } else if (foundMarkers.size > 0) {
                progress.style.color = '#4CAF50';
            }
        }

        function mostrarPista(markerId) {
            const pista = document.getElementById('pista');
            const titulo = document.getElementById('pista-titulo');
            const texto = document.getElementById('pista-texto');
            
            titulo.textContent = markerId === 'marker3' ? 'üéâ ¬°Tesoro Encontrado! üéâ' : 'üîç ¬°Nueva Pista!';
            texto.textContent = pistas[markerId];
            
            pista.style.display = 'block';
        }

        function cerrarPista() {
            document.getElementById('pista').style.display = 'none';
        }

        function crearConfetti() {
            const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff', '#ffa500', '#ff69b4'];
            
            for (let i = 0; i < 150; i++) {
                const confetti = document.createElement('div');
                confetti.style.position = 'fixed';
                confetti.style.width = Math.random() * 15 + 5 + 'px';
                confetti.style.height = Math.random() * 15 + 5 + 'px';
                confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0%';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.top = '-20px';
                confetti.style.zIndex = '9999';
                confetti.style.opacity = '0.8';
                
                // Animaci√≥n √∫nica para cada confeti
                const animationDuration = Math.random() * 3 + 2;
                const animationName = 'fall' + i;
                
                // Crear estilo de animaci√≥n √∫nico
                const style = document.createElement('style');
                style.textContent = `
                    @keyframes ${animationName} {
                        0% {
                            transform: translateY(0) rotate(0deg);
                            opacity: 1;
                        }
                        100% {
                            transform: translateY(100vh) rotate(${Math.random() * 720}deg);
                            opacity: 0;
                        }
                    }
                `;
                document.head.appendChild(style);
                
                confetti.style.animation = `${animationName} ${animationDuration}s linear forwards`;
                document.body.appendChild(confetti);
                
                // Remover despu√©s de la animaci√≥n
                setTimeout(() => {
                    if (confetti.parentNode) {
                        confetti.parentNode.removeChild(confetti);
                    }
                }, animationDuration * 1000);
            }
        }

        function resetGame() {
            foundMarkers.clear();
            updateProgress();
            document.getElementById('completion').style.display = 'none';
            document.getElementById('pista').style.display = 'none';
        }
    </script>
</body>
</html>
